# GameManager.gd
extends CharacterBody2D

# –¢–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –≤–æ–ª–Ω—ã
var current_wave := 1
# –ë–æ–Ω—É—Å –∑–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–æ–ª–Ω—ã
@export var wave_completion_bonus := 50
# –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
var player_gold := 100
var player_health := 20

func _ready():
	print("GameManager –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–∞—á–∞–ª—å–Ω–∞—è –≤–æ–ª–Ω–∞: ", current_wave)

# === –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–æ–ª–Ω ===
# –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π –≤–æ–ª–Ω—ã (—ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –∏—â–µ—Ç –≤–∞—à –º–æ–±)
func get_current_wave() -> int:
	return current_wave

# –ù–∞—á–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –≤–æ–ª–Ω—É (–≤—ã–∑—ã–≤–∞–π—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ–≥–¥–∞ –≤—Å–µ –º–æ–±—ã –≤–æ–ª–Ω—ã —É–±–∏—Ç—ã)
func start_next_wave():
	current_wave += 1
	print("üåä –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ–ª–Ω–∞: ", current_wave)
	# –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–ø–∞–≤–Ω–∞ –º–æ–±–æ–≤ –Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã
	# –ù–∞–ø—Ä–∏–º–µ—Ä: get_node("../MobSpawner").start_wave(current_wave)

# === –ú–µ—Ç–æ–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏–≥—Ä–æ–∫–∞ ===
func add_gold(amount: int):
	player_gold += amount
	print("üí∞ +", amount, " –∑–æ–ª–æ—Ç–∞. –í—Å–µ–≥–æ: ", player_gold)
	# –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
	# gold_changed.emit(player_gold)

func take_damage(damage: int):
	player_health -= damage
	print("üíî –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∏–ª —É—Ä–æ–Ω: ", damage, ". –û—Å—Ç–∞–ª–æ—Å—å –∑–¥–æ—Ä–æ–≤—å—è: ", player_health)
	if player_health <= 0:
		game_over()
	# –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
	# health_changed.emit(player_health)

func game_over():
	print("üíÄ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –≤–æ–ª–Ω—ã ", current_wave)
	# –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–≥—Ä—É –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø–æ—Ä–∞–∂–µ–Ω–∏—è
	
